# ğŸ“‹ ãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã€ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ–¹æ³•ã€ãŠã‚ˆã³CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ¯ ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ç¾åœ¨ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€æœ€ã‚‚é‡è¦ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆã«é›†ä¸­ã—ã¦ã„ã¾ã™ã€‚
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆã¨çµ±åˆãƒ†ã‚¹ãƒˆã¯ä½œæˆæ¸ˆã¿ã§ã™ãŒã€Next.js App Routerã¨AWS Amplifyã¨ã®çµ±åˆã®è¤‡é›‘ã•ã«ã‚ˆã‚Šã€ç¾åœ¨ã¯é™¤å¤–ã—ã¦ã„ã¾ã™ï¼ˆå°†æ¥çš„ã«E2Eãƒ†ã‚¹ãƒˆã§è£œå®Œäºˆå®šï¼‰ã€‚

### 3å±¤ãƒ†ã‚¹ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

#### 1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆâœ… å®Ÿè£…å®Œäº†ãƒ»ç¨¼åƒä¸­ï¼‰
**ç›®çš„**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨å€‹ã€…ã®é–¢æ•°ã®å‹•ä½œã‚’æ¤œè¨¼

- **çµ±è¨ˆè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯** (`utils/statistics.ts`)
  - `calculateOverallStats`: å…¨ä½“çµ±è¨ˆã®è¨ˆç®—
  - `calculateClassStats`: ã‚¯ãƒ©ã‚¹åˆ¥çµ±è¨ˆã®è¨ˆç®—
  - `calculateDeckTypeStats`: ãƒ‡ãƒƒã‚­ã‚¿ã‚¤ãƒ—åˆ¥çµ±è¨ˆã®è¨ˆç®—
  - `filterRecordsByDeck`: ãƒ‡ãƒƒã‚­ã«ã‚ˆã‚‹è¨˜éŒ²ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

- **å®šæ•°ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°** (`utils/constants.ts`)
  - `getWinRateColor`: å‹ç‡ã«åŸºã¥ãè‰²ã®æ±ºå®š
  - ã‚¯ãƒ©ã‚¹å®šæ•°ã¨è‰²ã®å®šç¾©

- **ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯** (`hooks/useLocalStorage.ts`)
  - LocalStorageã¨React stateã®åŒæœŸ
  - ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ã¨ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

#### 2. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆï¼ˆğŸ“ ä½œæˆæ¸ˆã¿ãƒ»ç¾åœ¨é™¤å¤–ä¸­ï¼‰
**ç›®çš„**: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æŒ¯ã‚‹èˆã„ã¨ç›¸äº’ä½œç”¨ã‚’æ¤œè¨¼

- **DeckForm**: ãƒ‡ãƒƒã‚­ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®å‹•ä½œ
- **MatchForm**: å¯¾æˆ¦è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®å‹•ä½œ
- **OverallStats**: çµ±è¨ˆè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ­£ç¢ºæ€§

**ç¾åœ¨ã®çŠ¶æ…‹**: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½œæˆæ¸ˆã¿ã§ã™ãŒã€Next.js App Routerã¨ã®çµ±åˆã®è¤‡é›‘ã•ã«ã‚ˆã‚Šä¸€æ™‚çš„ã«é™¤å¤–ã—ã¦ã„ã¾ã™ã€‚è©³ç´°ã¯ `components/__tests__/README.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### 3. çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆğŸ“ ä½œæˆæ¸ˆã¿ãƒ»ç¾åœ¨é™¤å¤–ä¸­ï¼‰
**ç›®çš„**: è¤‡æ•°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®é€£æºã‚’æ¤œè¨¼

- **AuthContext**: èªè¨¼ãƒ•ãƒ­ãƒ¼ã®çµ±åˆãƒ†ã‚¹ãƒˆ
- ãƒ‡ãƒ¼ã‚¿æ“ä½œã¨APIã®é€£æºï¼ˆãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼‰

**ç¾åœ¨ã®çŠ¶æ…‹**: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½œæˆæ¸ˆã¿ã§ã™ãŒã€AWS Amplify Authã®ãƒ¢ãƒƒã‚¯è¤‡é›‘æ€§ã«ã‚ˆã‚Šä¸€æ™‚çš„ã«é™¤å¤–ã—ã¦ã„ã¾ã™ã€‚è©³ç´°ã¯ `contexts/__tests__/README.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### 4. E2Eãƒ†ã‚¹ãƒˆï¼ˆğŸ”® å°†æ¥å®Ÿè£…äºˆå®šï¼‰
**ç›®çš„**: ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’æ¤œè¨¼

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã¾ã§ã®å®Œå…¨ãªãƒ•ãƒ­ãƒ¼
- ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®å®Ÿéš›ã®å‹•ä½œç¢ºèª
- Playwrightãªã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨äºˆå®š

## ğŸš€ ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ

```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm test

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆï¼ˆé–‹ç™ºæ™‚ï¼‰
npm run test:watch

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆä»˜ãã§ãƒ†ã‚¹ãƒˆ
npm run test:coverage

# CIç’°å¢ƒç”¨ã®ãƒ†ã‚¹ãƒˆ
npm run test:ci
```

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å‘½åè¦å‰‡

- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: `*.test.ts` ã¾ãŸã¯ `*.test.tsx`
- çµ±åˆãƒ†ã‚¹ãƒˆ: `*.integration.test.ts`
- E2Eãƒ†ã‚¹ãƒˆ: `*.e2e.test.ts`ï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®

```
project-root/
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ __tests__/
â”‚       â”œâ”€â”€ statistics.test.ts
â”‚       â””â”€â”€ constants.test.ts
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ __tests__/
â”‚       â””â”€â”€ useLocalStorage.test.ts
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ deck/
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â””â”€â”€ DeckForm.test.tsx
â”‚   â”œâ”€â”€ match/
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â””â”€â”€ MatchForm.test.tsx
â”‚   â””â”€â”€ stats/
â”‚       â””â”€â”€ __tests__/
â”‚           â””â”€â”€ OverallStats.test.tsx
â””â”€â”€ contexts/
    â””â”€â”€ __tests__/
        â””â”€â”€ AuthContext.test.tsx
```

## ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ï¼ˆ`jest.config.js`ã§è¨­å®šï¼‰:

- **Lines**: 70%ä»¥ä¸Š
- **Functions**: 60%ä»¥ä¸Š
- **Branches**: 60%ä»¥ä¸Š
- **Statements**: 70%ä»¥ä¸Š

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ç¢ºèª

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
npm run test:coverage

# HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’é–‹ã
open coverage/lcov-report/index.html
```

## ğŸ”„ GitHub Actions CI/CD

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

#### 1. CI (`ci.yml`)
**ãƒˆãƒªã‚¬ãƒ¼**: mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

- âœ… Node.js 18.x ã¨ 20.x ã§ã®ãƒ†ã‚¹ãƒˆ
- âœ… ESLintã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
- âœ… TypeScriptå‹ãƒã‚§ãƒƒã‚¯
- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
- âœ… ãƒ“ãƒ«ãƒ‰ã®æˆåŠŸç¢ºèª
- âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

#### 2. PRãƒã‚§ãƒƒã‚¯ (`pr-checks.yml`)
**ãƒˆãƒªã‚¬ãƒ¼**: ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆãƒ»æ›´æ–°

- ğŸ“Š ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆï¼ˆè‡ªå‹•ã‚³ãƒ¡ãƒ³ãƒˆï¼‰
- ğŸ¨ ESLintçµæœã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- ğŸ“¦ ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºåˆ†æ
- ğŸ” å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œå‡ºã¨å¯¾è±¡ã‚’çµã£ãŸãƒ†ã‚¹ãƒˆ

#### 3. ãƒ‡ãƒ—ãƒ­ã‚¤ (`deploy.yml`)
**ãƒˆãƒªã‚¬ãƒ¼**: mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥

- ğŸ§ª ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®å¿…é ˆãƒ†ã‚¹ãƒˆ
- ğŸš€ AWS Amplifyã¸ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- âœ… ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
- ğŸ“ ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µãƒãƒªãƒ¼ã®ç”Ÿæˆ

### å¿…è¦ãªGitHub Secrets

ä»¥ä¸‹ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’GitHubãƒªãƒã‚¸ãƒˆãƒªã«è¨­å®šã—ã¦ãã ã•ã„:

```
AWS_ACCESS_KEY_ID       # AWSèªè¨¼ç”¨
AWS_SECRET_ACCESS_KEY   # AWSèªè¨¼ç”¨
```

## ğŸ› ï¸ ãƒ†ã‚¹ãƒˆç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ä¾å­˜é–¢ä¿‚

```json
{
  "devDependencies": {
    "jest": "^30.2.0",
    "@testing-library/react": "^16.3.0",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/user-event": "^14.6.1",
    "@types/jest": "^30.0.0",
    "jest-environment-jsdom": "^30.2.0"
  }
}
```

### Jestè¨­å®š

`jest.config.js`ã§Next.jsã¨ã®çµ±åˆã€ã‚«ãƒãƒ¬ãƒƒã‚¸è¨­å®šã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å®šç¾©ã€‚

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«

`jest.setup.js`ã§ä»¥ä¸‹ã‚’ãƒ¢ãƒƒã‚¯:
- `window.matchMedia`
- `localStorage`
- `fetch`
- AWS Amplify

## ğŸ“ ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ä¾‹

```typescript
describe('calculateOverallStats', () => {
  it('should calculate correct overall statistics', () => {
    const stats = calculateOverallStats(mockRecords)

    expect(stats.totalGames).toBe(4)
    expect(stats.wins).toBe(3)
    expect(stats.losses).toBe(1)
    expect(stats.winRate).toBe(75.0)
  })
})
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆã®ä¾‹

```typescript
describe('DeckForm', () => {
  it('should call onSubmit with correct values', async () => {
    const user = userEvent.setup()
    render(<DeckForm onSubmit={mockOnSubmit} />)

    await user.selectOptions(screen.getByLabelText('ã‚¯ãƒ©ã‚¹'), 'ã‚¨ãƒ«ãƒ•')
    await user.type(screen.getByLabelText('ãƒ‡ãƒƒã‚­å'), 'ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­')
    await user.click(screen.getByRole('button', { name: 'è¿½åŠ ' }))

    expect(mockOnSubmit).toHaveBeenCalledWith('ã‚¨ãƒ«ãƒ•', 'ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­')
  })
})
```

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. ãƒ†ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹
```bash
# ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å»¶é•·
npm test -- --testTimeout=10000
```

#### 2. ãƒ¢ãƒƒã‚¯ãŒæ­£ã—ãå‹•ä½œã—ãªã„
`jest.clearAllMocks()`ã‚’`beforeEach`ã§å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

#### 3. ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒç›®æ¨™ã«é”ã—ãªã„
æœªãƒ†ã‚¹ãƒˆã®ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹ã‚’ç‰¹å®š:
```bash
npm run test:coverage -- --collectCoverageFrom='utils/**/*.ts'
```

## ğŸ”® ä»Šå¾Œã®æ”¹å–„äºˆå®š

- [ ] E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰ã®è¿½åŠ 
- [ ] ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
- [ ] å›½éš›åŒ–ï¼ˆi18nï¼‰ãƒ†ã‚¹ãƒˆ

## ğŸ“š å‚è€ƒè³‡æ–™

- [Jest Documentation](https://jestjs.io/docs/getting-started)
- [React Testing Library](https://testing-library.com/docs/react-testing-library/intro/)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [AWS Amplify Testing Guide](https://docs.amplify.aws/lib/client-configuration/testing/q/platform/js/)

---

**æœ€çµ‚æ›´æ–°**: 2024å¹´11æœˆ